<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universidad Horarios</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-container">
            <img src="logo.png" alt="Logo">
            <h1>Universidad<br>Horarios</h1>
        </div>

        <ul class="nav-menu">
            <li class="nav-item active" data-view="dashboard">
                <div class="nav-icon"><i class="fas fa-th-large"></i></div>
                <span>Dashboard</span>
            </li>
            <li class="nav-item" data-view="maestros">
                <div class="nav-icon"><i class="fas fa-users"></i></div>
                <span>Maestros</span>
            </li>
            <li class="nav-item" data-view="disponibilidad">
                <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
                <span>Disponibilidad</span>
            </li>
            <li class="nav-item" data-view="horario">
                <div class="nav-icon"><i class="fas fa-clock"></i></div>
                <span>Horario</span>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div id="notification" class="notification"></div>

        <div class="header-section">
            <h2 class="page-title" id="page-title">Panel de Control</h2>
        </div>

        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="view-section">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                    <div class="stat-info">
                        <h3>Ciclo Actual</h3>
                        <p id="cycle-name">No seleccionado</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-book"></i></div>
                    <div class="stat-info">
                        <h3>Cursos</h3>
                        <p id="course-count">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    <div class="stat-info">
                        <h3>Profesores</h3>
                        <p id="professor-count">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-info">
                        <h3>Horarios</h3>
                        <p id="timeslot-count">0</p>
                    </div>
                </div>
            </div>

            <!-- Cycle Selection -->
            <section class="cycle-section">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-calendar-alt"></i> Seleccionar Ciclo Académico</h2>
                        <p class="section-desc">Elige el periodo cuatrimestral para generar el horario</p>
                    </div>
                </div>
                
                <div class="cycle-selector-wrapper">
                    <div class="cycle-select-container">
                        <label for="cycle-select">
                            <i class="fas fa-graduation-cap"></i> Ciclo Cuatrimestral
                        </label>
                        <div class="select-wrapper">
                            <select id="cycle-select" onchange="loadCycleData()">
                                <option value="">-- Seleccionar ciclo académico --</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                    
                    <div id="cycle-info" class="cycle-info-card" style="display: none;">
                        <div class="cycle-info-header">
                            <i class="fas fa-info-circle"></i>
                            <span>Información del Ciclo</span>
                        </div>
                        <div class="cycle-info-body">
                            <div class="info-row">
                                <div class="info-label">
                                    <i class="fas fa-calendar"></i>
                                    <span>Periodo</span>
                                </div>
                                <div class="info-value" id="cycle-months">-</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">
                                    <i class="fas fa-book-open"></i>
                                    <span>Cuatrimestres</span>
                                </div>
                                <div class="info-value">
                                    <div id="cycle-semesters-badges" class="semester-badges"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upload -->
            <section class="upload-section">
                <h2>Cargar Datos</h2>
                <p class="section-desc">Sube archivos CSV, JSON o Excel</p>
                <div class="upload-grid">
                    <div class="upload-card" id="card-professors"
                        onclick="document.getElementById('professor-upload').click()">
                        <div class="upload-status-icon"><i class="fas fa-check-circle"></i></div>
                        <i class="fas fa-file-alt upload-icon"></i>
                        <h3>Profesores</h3>
                        <p>CSV, JSON, Excel</p>
                        <input type="file" id="professor-upload" hidden onchange="uploadFile(this, 'professors')">
                    </div>
                    <div class="upload-card" id="card-timeslots"
                        onclick="document.getElementById('timeslot-upload').click()">
                        <div class="upload-status-icon"><i class="fas fa-check-circle"></i></div>
                        <i class="fas fa-file-alt upload-icon"></i>
                        <h3>Horarios</h3>
                        <p>CSV, JSON, Excel</p>
                        <input type="file" id="timeslot-upload" hidden onchange="uploadFile(this, 'timeslots')">
                    </div>
                </div>
            </section>

            <!-- Generate -->
            <section class="generate-section">
                <div class="generate-header">
                    <div>
                        <h2>Generar Horario</h2>
                        <p class="section-desc">Generar horario óptimo sin conflictos</p>
                    </div>
                    <button id="generate-btn" class="btn-primary" onclick="generateSchedule()">
                        <i class="fas fa-bolt"></i> Generar Horario
                    </button>
                </div>
            </section>
        </div>

        <!-- VIEW: MAESTROS -->
        <div id="view-maestros" class="view-section" style="display: none;">
            <div class="toolbar">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-professor" placeholder="Buscar Maestro" onkeyup="filterProfessors()">
                </div>
                <button class="btn-primary" onclick="openProfessorModal()">
                    <i class="fas fa-plus"></i> Añadir Maestro
                </button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Maestro</th>
                            <th>Correo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="professors-list">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: DISPONIBILIDAD -->
        <div id="view-disponibilidad" class="view-section" style="display: none;">
            <div class="availability-layout-vertical">
                <!-- Top: Controls -->
                <div class="card controls-card">
                    <div class="controls-row">
                        <div class="form-group">
                            <label>Maestro</label>
                            <select id="availability-professor-select" onchange="loadProfessorAvailability()">
                                <option value="">Seleccionar Maestro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Filtrar por Materia</label>
                            <input type="text" id="availability-filter-subject" placeholder="Buscar materia..."
                                onkeyup="filterProfessorsBySubject()">
                        </div>
                        <div class="actions">
                            <button class="btn-primary" onclick="saveAvailability()">
                                <i class="fas fa-save"></i> Guardar Datos
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bottom: Calendar Grid -->
                <div class="card calendar-card full-width">
                    <h3>Disponibilidad Semanal</h3>
                    <p class="subtitle">Los días en las columnas, los intervalos de tiempo en las filas.</p>

                    <div id="calendar-overlay" class="calendar-overlay">
                        <div class="overlay-msg">Selecciona un maestro para editar su disponibilidad</div>
                    </div>

                    <div class="availability-grid-container">
                        <table class="availability-table">
                            <thead>
                                <tr>
                                    <th>Horas</th>
                                    <th>Lun</th>
                                    <th>Mar</th>
                                    <th>Mié</th>
                                    <th>Jue</th>
                                    <th>Vie</th>
                                </tr>
                            </thead>
                            <tbody id="availability-grid">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: HORARIO -->
        <div id="view-horario" class="view-section" style="display: none;">
            <div id="schedule-result" class="schedule-container">
                <div class="empty-state" id="no-schedule-msg">
                    <i class="fas fa-calendar-times"></i>
                    <p>No hay horario generado aún. Ve al Dashboard para generar uno.</p>
                </div>
                <table class="schedule-table" id="schedule-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Curso</th>
                            <th>Profesor</th>
                            <th>Horario</th>
                            <th>Grupo</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Professor Modal -->
    <div id="professor-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Añadir Maestro</h3>
                <span class="close-modal" onclick="closeProfessorModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="prof-id">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="prof-name" placeholder="Ej. Dr. Juan Pérez">
                </div>
                <div class="form-group">
                    <label>Correo Electrónico</label>
                    <input type="email" id="prof-email" placeholder="juan@university.edu">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeProfessorModal()">Cancelar</button>
                <button class="btn-primary" onclick="saveProfessor()">Guardar</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>