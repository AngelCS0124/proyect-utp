<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universidad Horarios</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Vis.js para visualización de grafos -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/dist/vis-network.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js"></script>
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-container">
            <img src="logo.png" alt="Logo">
            <h1>Universidad<br>Horarios</h1>
        </div>

        <ul class="nav-menu">
            <li class="nav-item active" data-view="dashboard">
                <div class="nav-icon"><i class="fas fa-th-large"></i></div>
                <span>Dashboard</span>
            </li>
            <li class="nav-item" data-view="maestros">
                <div class="nav-icon"><i class="fas fa-users"></i></div>
                <span>Maestros</span>
            </li>
            <li class="nav-item" data-view="disponibilidad">
                <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
                <span>Disponibilidad</span>
            </li>
            <li class="nav-item" data-view="horario">
                <div class="nav-icon"><i class="fas fa-clock"></i></div>
                <span>Horario</span>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div id="notification" class="notification"></div>

        <div class="header-section">
            <h2 class="page-title" id="page-title">Panel de Control</h2>
        </div>

        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="view-section">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                    <div class="stat-info">
                        <h3>Ciclo Actual</h3>
                        <p id="cycle-name">No seleccionado</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-book"></i></div>
                    <div class="stat-info">
                        <h3>Cursos</h3>
                        <p id="course-count">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                    <div class="stat-info">
                        <h3>Profesores</h3>
                        <p id="professor-count">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-info">
                        <h3>Horarios</h3>
                        <p id="timeslot-count">0</p>
                    </div>
                </div>
            </div>

            <!-- Cycle Selection -->
            <section class="cycle-section">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-calendar-alt"></i> Seleccionar Ciclo Académico</h2>
                        <p class="section-desc">Elige el periodo cuatrimestral para generar el horario</p>
                    </div>
                </div>

                <div class="cycle-selector-wrapper">
                    <div class="cycle-select-container">
                        <label for="cycle-select">
                            <i class="fas fa-graduation-cap"></i> Ciclo Cuatrimestral
                        </label>
                        <div class="select-wrapper">
                            <select id="cycle-select" onchange="loadCycleData()">
                                <option value="">-- Seleccionar ciclo académico --</option>
                            </select>
                            <i class="fas fa-chevron-down select-arrow"></i>
                        </div>
                    </div>

                    <div id="cycle-info" class="cycle-info-card" style="display: none;">
                        <div class="cycle-info-header">
                            <i class="fas fa-info-circle"></i>
                            <span>Información del Ciclo</span>
                        </div>
                        <div class="cycle-info-body">
                            <div class="info-row">
                                <div class="info-label">
                                    <i class="fas fa-calendar"></i>
                                    <span>Periodo</span>
                                </div>
                                <div class="info-value" id="cycle-months">-</div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">
                                    <i class="fas fa-book-open"></i>
                                    <span>Cuatrimestres</span>
                                </div>
                                <div class="info-value">
                                    <div id="cycle-semesters-badges" class="semester-badges"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Upload -->
            <section class="upload-section">
                <h2>Cargar Datos</h2>
                <p class="section-desc">Sube archivos CSV, JSON o Excel, o carga datos de ejemplo.</p>

                <div style="margin-bottom: 20px;">
                    <button class="btn-secondary" onclick="loadDefaultData()"
                        style="width: 100%; padding: 15px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <i class="fas fa-database"></i>
                        <div>
                            <div style="font-weight: 600;">Cargar Datos de Ejemplo (Excel)</div>
                            <div style="font-size: 0.8em; opacity: 0.8;">Horarios EneAbr18(1).xlsx</div>
                        </div>
                    </button>
                </div>

                <div class="upload-grid">
                    <div class="upload-card" id="card-professors"
                        onclick="document.getElementById('professor-upload').click()">
                        <div class="upload-status-icon"><i class="fas fa-check-circle"></i></div>
                        <i class="fas fa-file-alt upload-icon"></i>
                        <h3>Profesores y Disponibilidad</h3>
                        <p>Sube el archivo JSON completo (professors.json)</p>
                        <input type="file" id="professor-upload" hidden onchange="uploadFile(this, 'professors')">
                    </div>

                    <div class="upload-card" id="card-courses"
                        onclick="document.getElementById('course-upload').click()">
                        <div class="upload-status-icon"><i class="fas fa-check-circle"></i></div>
                        <i class="fas fa-book upload-icon"></i>
                        <h3>Cursos</h3>
                        <p>Sube el archivo CSV de cursos (courses.csv)</p>
                        <input type="file" id="course-upload" hidden onchange="uploadFile(this, 'courses')">
                    </div>

                    <div class="upload-card" id="card-timeslots"
                        onclick="document.getElementById('timeslot-upload').click()">
                        <div class="upload-status-icon"><i class="fas fa-check-circle"></i></div>
                        <i class="fas fa-clock upload-icon"></i>
                        <h3>Horarios</h3>
                        <p>Sube el archivo JSON de horarios (timeslots.json)</p>
                        <input type="file" id="timeslot-upload" hidden onchange="uploadFile(this, 'timeslots')">
                    </div>

                </div>
            </section>

            <!-- Generate -->
            <section class="generate-section">
                <div class="generate-header">
                    <div style="flex: 1;">
                        <h2>Generar Horario</h2>
                        <p class="section-desc">Generar horario óptimo sin conflictos</p>
                    </div>

                    <div class="config-controls"
                        style="display: flex; gap: 15px; align-items: center; margin-right: 20px;">
                        <div class="config-item">
                            <label for="time-limit"
                                style="display: block; font-size: 0.85rem; margin-bottom: 4px; color: var(--text-gray);"><i
                                    class="fas fa-stopwatch"></i> Límite:</label>
                            <select id="time-limit" class="form-select"
                                style="padding: 8px; border-radius: 6px; border: 1px solid #e2e8f0;">
                                <option value="0">Sin límite</option>
                                <option value="30">30 Segundos</option>
                                <option value="60">1 Minuto</option>
                                <option value="300">5 Minutos</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="strategy"
                                style="display: block; font-size: 0.85rem; margin-bottom: 4px; color: var(--text-gray);"><i
                                    class="fas fa-chess"></i> Estrategia:</label>
                            <select id="strategy" class="form-select"
                                style="padding: 8px; border-radius: 6px; border: 1px solid #e2e8f0;">
                                <option value="complete">Completa</option>
                                <option value="best_effort">Mejor Esfuerzo</option>
                            </select>
                        </div>
                    </div>

                    <button id="generate-btn" class="btn-primary" onclick="generateSchedule()">
                        <i class="fas fa-bolt"></i> Generar Horario
                    </button>
                </div>
            </section>
        </div>

        <!-- VIEW: MAESTROS -->
        <div id="view-maestros" class="view-section" style="display: none;">
            <div class="toolbar">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-professor" placeholder="Buscar Maestro" onkeyup="filterProfessors()">
                </div>
                <button class="btn-secondary" onclick="saveAllProfessors()" style="margin-right: 10px;">
                    <i class="fas fa-save"></i> Guardar en Archivo
                </button>
                <button class="btn-primary" onclick="openProfessorModal()">
                    <i class="fas fa-plus"></i> Añadir Maestro
                </button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Maestro</th>
                            <th>Correo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="professors-list">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: DISPONIBILIDAD -->
        <div id="view-disponibilidad" class="view-section" style="display: none;">
            <div class="availability-layout-vertical">
                <!-- Top: Controls -->
                <div class="card controls-card">
                    <div class="controls-row">
                        <div class="form-group">
                            <label>Maestro</label>
                            <select id="availability-professor-select" onchange="loadProfessorAvailability()">
                                <option value="">Seleccionar Maestro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Filtrar por Materia</label>
                            <input type="text" id="availability-filter-subject" placeholder="Buscar materia..."
                                onkeyup="filterProfessorsBySubject()">
                        </div>
                        <div class="actions">
                            <button class="btn-primary" onclick="saveAvailability()">
                                <i class="fas fa-save"></i> Guardar Datos
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bottom: Calendar Grid -->
                <div class="card calendar-card full-width">
                    <h3>Disponibilidad Semanal</h3>
                    <p class="subtitle">Los días en las columnas, los intervalos de tiempo en las filas.</p>

                    <div id="calendar-overlay" class="calendar-overlay">
                        <div class="overlay-msg">Selecciona un maestro para editar su disponibilidad</div>
                    </div>

                    <div class="availability-grid-container">
                        <table class="availability-table">
                            <thead>
                                <tr>
                                    <th>Horas</th>
                                    <th>Lun</th>
                                    <th>Mar</th>
                                    <th>Mié</th>
                                    <th>Jue</th>
                                    <th>Vie</th>
                                </tr>
                            </thead>
                            <tbody id="availability-grid">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: HORARIO -->
        <div id="view-horario" class="view-section" style="display: none;">
            <div id="schedule-result" class="schedule-container">
                <div class="empty-state" id="no-schedule-msg">
                    <i class="fas fa-calendar-times"></i>
                    <p>No hay horario generado aún. Ve al Dashboard para generar uno.</p>
                </div>

                <div class="schedule-filters" id="schedule-filters" style="display: none; margin-bottom: 20px;">
                    <label for="semester-filter"><i class="fas fa-filter"></i> Filtrar por Cuatrimestre:</label>
                    <select id="semester-filter" onchange="filterScheduleBySemester()" class="form-select">
                        <option value="all">Todos los Cuatrimestres</option>
                        <option value="1">Primer Cuatrimestre</option>
                        <option value="2">Segundo Cuatrimestre</option>
                        <option value="3">Tercer Cuatrimestre</option>
                        <option value="4">Cuarto Cuatrimestre</option>
                        <option value="5">Quinto Cuatrimestre</option>
                        <option value="6">Sexto Cuatrimestre</option>
                        <option value="7">Séptimo Cuatrimestre</option>
                        <option value="8">Octavo Cuatrimestre</option>
                        <option value="9">Noveno Cuatrimestre</option>
                        <option value="10">Décimo Cuatrimestre</option>
                    </select>
                </div>

                <!-- Controles de visualización -->
                <div class="visualization-controls" id="viz-controls" style="display: none;">
                    <div class="view-toggles">
                        <button class="btn-secondary active" id="btn-view-list" onclick="switchScheduleView('list')">
                            <i class="fas fa-list"></i> Lista
                        </button>
                        <button class="btn-secondary" id="btn-view-calendar" onclick="switchScheduleView('calendar')">
                            <i class="fas fa-calendar-alt"></i> Calendario
                        </button>
                    </div>
                    <button onclick="mostrarVisualizacion()" class="btn-secondary">
                        <i class="fas fa-project-diagram"></i>
                        Ver Estructura del Algoritmo
                    </button>
                    <button onclick="exportarHorario()" class="btn-secondary">
                        <i class="fas fa-download"></i>
                        Exportar Horario
                    </button>
                </div>

                <div id="schedule-list-container">
                    <table class="schedule-table" id="schedule-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>Curso</th>
                                <th>Profesor</th>
                                <th>Horario</th>
                                <th>Grupo</th>
                            </tr>
                        </thead>
                        <tbody id="schedule-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <div id="schedule-calendar-container" style="display: none;">
                    <!-- Calendar grids will be injected here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Professor Modal -->
    <div id="professor-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Añadir Maestro</h3>
                <span class="close-modal" onclick="closeProfessorModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="hidden" id="prof-id">
                <div class="form-group">
                    <label>Nombre Completo</label>
                    <input type="text" id="prof-name" placeholder="Ej. Dr. Juan Pérez">
                </div>
                <div class="form-group">
                    <label>Correo Electrónico</label>
                    <input type="email" id="prof-email" placeholder="juan@university.edu">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeProfessorModal()">Cancelar</button>
                <button class="btn-primary" onclick="saveProfessor()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Visualization Modal -->
    <div id="visualization-modal" class="modal">
        <div class="modal-content visualization-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-project-diagram"></i> Visualización del Algoritmo de Scheduling</h3>
                <span class="close-modal" onclick="cerrarVisualizacion()">&times;</span>
            </div>

            <div class="modal-body">
                <!-- Tabs para cambiar entre vistas -->
                <div class="viz-tabs">
                    <button class="viz-tab active" onclick="cambiarVistaViz('conflictos')" data-viz="conflictos">
                        <i class="fas fa-exclamation-triangle"></i>
                        Grafo de Conflictos
                    </button>
                    <button class="viz-tab" onclick="cambiarVistaViz('restricciones')" data-viz="restricciones">
                        <i class="fas fa-network-wired"></i>
                        Red de Restricciones
                    </button>
                    <button class="viz-tab" onclick="cambiarVistaViz('backtracking')" data-viz="backtracking">
                        <i class="fas fa-sitemap"></i>
                        Árbol de Backtracking
                    </button>
                </div>

                <!-- Contenedor del grafo -->
                <div id="network-container" class="network-container"></div>

                <!-- Información y controles -->
                <div class="viz-info-panel">
                    <!-- Leyenda -->
                    <div class="viz-legend">
                        <h4><i class="fas fa-info-circle"></i> Leyenda</h4>
                        <div id="legend-content"></div>
                    </div>

                    <!-- Estadísticas -->
                    <div class="viz-stats">
                        <h4><i class="fas fa-chart-bar"></i> Estadísticas</h4>
                        <div class="stats-grid-viz">
                            <div class="stat-item-viz">
                                <span class="stat-label">Total Cursos</span>
                                <span class="stat-value" id="stat-cursos">0</span>
                            </div>
                            <div class="stat-item-viz">
                                <span class="stat-label">Total Profesores</span>
                                <span class="stat-value" id="stat-profesores">0</span>
                            </div>
                            <div class="stat-item-viz">
                                <span class="stat-label">Conflictos Detectados</span>
                                <span class="stat-value" id="stat-conflictos">0</span>
                            </div>
                            <div class="stat-item-viz">
                                <span class="stat-label">Asignaciones Exitosas</span>
                                <span class="stat-value" id="stat-asignaciones">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarVisualizacion()">Cerrar</button>
                <button class="btn-primary" onclick="exportarVisualizacion()">
                    <i class="fas fa-camera"></i> Capturar Imagen
                </button>
            </div>
        </div>
    </div>

    <script src="visualization.js"></script>
    <script src="app.js"></script>
</body>

</html>